# Smart Workflows for Integrated Security Testing
# Intelligent workflows that combine multiple tools automatically
# Reduces cognitive load from 100+ individual tasks to smart, context-aware workflows
# Combined from PRs #194, #195, #196

# ============================================================================
# Core Smart Workflows - The "Just Works" Tasks
# ============================================================================

task smart-detect-tools
  describe Detect available security tools and their capabilities
  shell node tools/orchestration/tool-detector.mjs --format json --output tools-capabilities.json
  shell echo "Tool capabilities saved to tools-capabilities.json"
  shell echo "Use 'pf smart-show-capabilities' to view available tools"
end

task smart-show-capabilities
  describe Show detected tool capabilities in human-readable format
  shell node tools/orchestration/tool-detector.mjs --format table
end

task smart-detect
  describe Intelligently detect target type and recommend workflow
  shell python3 tools/smart-workflows/target_detector.py ${target} ${format:+--format $format}
end

task smart-analyze
  describe Comprehensive smart analysis of any target
  shell test -n "${target}" || (echo "âŒ Error: target parameter required" && exit 1)
  shell echo "ğŸ§  Smart Analysis starting for: ${target}"
  shell python3 tools/smart-workflows/target_detector.py ${target} --format json > .smart_target_info.json
  shell python3 tools/orchestration/smart_analyzer.py ${target} ${deep:+--deep-analysis} ${format:+--format $format} ${output:+--output $output}
end

task smart-exploit
  describe  ğŸ¯ Smart exploit development - from binary to working exploit automatically
  shell test -n "${binary}" || (echo "âŒ Error: binary parameter required" && exit 1)
  shell echo "ğŸ’¥ Smart Exploit Development: ${binary}"
  shell python3 tools/orchestration/smart_exploiter.py ${binary} ${output:+--output $output} ${arch:+--arch $arch} ${technique:+--technique $technique}
end

task smart-fuzz
  describe ğŸš€ Smart fuzzing - automatically detects target type and uses optimal strategy
  shell test -n "${target}" || (echo "âŒ Error: target parameter required" && exit 1)
  shell python3 tools/smart-workflows/smart_fuzzer_selector.py ${target} ${duration:+--duration $duration} ${strategy:+--strategy $strategy}
end

task smart-security-test
  describe ğŸ”’ Smart security testing - comprehensive security assessment
  shell test -n "${target}" || (echo "âŒ Error: target parameter required" && exit 1)
  shell python3 tools/smart-workflows/smart_scanner.py ${target} ${mode:+--mode $mode}
end

# ============================================================================
# Intelligent Binary Analysis Workflows
# ============================================================================

task smart-binary-analysis
  describe Complete automated binary analysis workflow (binary=path/to/binary)
  shell test -n "${binary}" || (echo "Error: binary parameter required" && exit 1)
  shell echo "ğŸ” Starting intelligent binary analysis for: ${binary}"
  shell node tools/orchestration/workflow-engine.mjs binary-analysis --target "${binary}" --output "${output:-analysis-report.json}" --verbose
end

task smart-binary-exploit
  describe Full binary analysis + exploit generation workflow (binary=path/to/binary)
  shell test -n "${binary}" || (echo "Error: binary parameter required" && exit 1)
  shell echo "ğŸ’¥ Starting binary exploitation workflow for: ${binary}"
  shell node tools/orchestration/workflow-engine.mjs binary-exploit --target "${binary}" --output "${output:-exploit-report.json}" --generate-payloads
end

# ============================================================================
# One-Command Complete Workflows (from PR #196)
# ============================================================================

task autopwn
  describe Complete binary exploitation: analysis + vulnerability discovery + exploit generation (binary=path/to/binary)
  shell test -n "${binary}" || (echo "âŒ Error: binary parameter required" && exit 1)
  shell echo "ğŸ¯ AutoPwn: Complete binary exploitation workflow"
  shell echo "Target: ${binary}"
  shell echo ""
  
  # Phase 1: Basic Analysis
  shell echo "ğŸ“‹ Phase 1: Basic Analysis"
  shell pf unified-checksec binary="${binary}" || true
  shell file "${binary}"
  shell echo ""
  
  # Phase 2: Vulnerability Discovery
  shell echo "ğŸ” Phase 2: Vulnerability Discovery"
  shell pf debug-analyze-binary binary="${binary}" quick=true || true
  shell strings "${binary}" | grep -E "(password|admin|flag|key)" | head -10 || true
  shell echo ""
  
  # Phase 3: Exploitation Prep
  shell echo "ğŸ’¥ Phase 3: Exploitation Preparation"
  shell pf rop-find-gadgets binary="${binary}" limit=20 || true
  shell pf create-exploit-template binary="${binary}" type=buffer_overflow || true
  shell echo ""
  
  shell echo "âœ… AutoPwn complete! Check generated exploit template and ROP gadgets."
end

task autoweb
  describe Complete web security assessment: discovery + scanning + exploitation (url=http://target)
  shell test -n "${url}" || (echo "âŒ Error: url parameter required" && exit 1)
  shell echo "ğŸŒ AutoWeb: Complete web security assessment"
  shell echo "Target: ${url}"
  shell echo ""
  
  # Phase 1: Discovery
  shell echo "ğŸ“‹ Phase 1: Service Discovery"
  shell curl -I "${url}" 2>/dev/null | head -10 || echo "Basic HTTP check failed"
  shell echo ""
  
  # Phase 2: Security Scanning
  shell echo "ğŸ” Phase 2: Security Scanning"
  shell pf security-scan url="${url}" checks=sqli,xss,cmdi || true
  shell echo ""
  
  # Phase 3: Fuzzing
  shell echo "ğŸ’¥ Phase 3: Vulnerability Fuzzing"
  shell pf security-fuzz url="${url}" type=all || true
  shell echo ""
  
  shell echo "âœ… AutoWeb complete! Review security scan and fuzzing results."
end

# ============================================================================
# Unified Tool Interfaces
# ============================================================================

task unified-checksec
  describe ğŸ›¡ï¸ Unified binary security analysis - smart checksec that chooses best approach
  shell python3 tools/unified/unified_checksec.py ${binary} ${format:+--format $format} ${batch:+--batch} ${output:+--output $output}
end

task checksec-unified
  describe Unified binary security analysis (replaces all other checksec implementations)
  shell test -n "${binary}" || (echo "Error: binary parameter required. Usage: pf checksec-unified binary=/path/to/binary" && exit 1)
  shell python3 tools/unified/unified_checksec.py ${binary} ${json:+--json} ${output:+--output $output}
end

# ============================================================================
# Workflow Management
# ============================================================================

task workflow-status
  describe ğŸ“Š Show status of running smart workflows
  shell python3 tools/orchestration/workflow_manager.py --status ${workflow_id:+--workflow-id $workflow_id}
end

task workflow-history
  describe ğŸ“œ Show workflow execution history and results
  shell python3 tools/orchestration/workflow_manager.py --history ${limit:+--limit $limit} ${filter:+--filter $filter}
end

# ============================================================================
# Quick Aliases for Power Users
# ============================================================================

task apwn
  describe Alias for autopwn
  shell pf autopwn binary=${binary}
end

task aweb
  describe Alias for autoweb
  shell pf autoweb url=${url}
end

task stools
  describe Alias for smart-detect-tools
  shell pf smart-detect-tools
end

task smart-help
  describe â“ Show smart workflows help and usage examples
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘                SMART WORKFLOWS HELP                       â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "ğŸ§  CORE SMART WORKFLOWS (The \"Just Works\" Tasks):"
  shell echo ""
  shell echo "  pf smart-analyze target=<file>           # Smart binary analysis"
  shell echo "  pf smart-exploit binary=<file>           # Automated exploit development"
  shell echo "  pf smart-fuzz target=<file|url>          # Adaptive fuzzing"
  shell echo "  pf smart-security-test target=<file|url> # Comprehensive security testing"
  shell echo ""
  shell echo "ğŸ¯ ONE-COMMAND WORKFLOWS:"
  shell echo ""
  shell echo "  pf autopwn binary=<file>                 # Complete binary exploitation"
  shell echo "  pf autoweb url=<url>                     # Complete web security assessment"
  shell echo ""
  shell echo "ğŸ”¬ ADVANCED WORKFLOWS:"
  shell echo ""
  shell echo "  pf smart-detect target=<file>            # Detect target type"
  shell echo "  pf smart-binary-analysis binary=<file>   # Full binary analysis"
  shell echo ""
  shell echo "ğŸ› ï¸ UNIFIED TOOL INTERFACES:"
  shell echo ""
  shell echo "  pf unified-checksec binary=<file>        # Smart binary security analysis"
  shell echo ""
  shell echo "ğŸ“Š WORKFLOW MANAGEMENT:"
  shell echo ""
  shell echo "  pf workflow-status                       # Show running workflows"
  shell echo "  pf workflow-history                      # Show execution history"
  shell echo ""
  shell echo "âš¡ QUICK ALIASES:"
  shell echo ""
  shell echo "  pf apwn binary=<file>                    # Short for autopwn"
  shell echo "  pf aweb url=<url>                        # Short for autoweb"
  shell echo "  pf stools                                # Short for smart-detect-tools"
  shell echo ""
  shell echo "For detailed documentation, see: docs/SMART-WORKFLOWS.md"
=======
# Smart Integrated Workflows
# Combines multiple tools intelligently for common security and analysis tasks

# ============================================================================
# Smart Binary Analysis Workflow
# ============================================================================

task smart-binary-analysis
  describe Comprehensive binary analysis: checksec â†’ lift â†’ analyze â†’ debug-prep
  describe Automatically analyzes a binary using all available tools intelligently
  shell_lang bash
  shell test -n "${binary}" || (echo "Error: binary parameter required. Usage: pf smart-binary-analysis binary=/path/to/binary" && exit 1)
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         SMART BINARY ANALYSIS WORKFLOW                   â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "Target: ${binary}"
  shell echo ""
  shell echo "=== Phase 1: Security Check (checksec) ==="
  shell python3 tools/exploit/checksec_batch.py ${binary} --output /tmp/smart-analysis-${$}.json || echo "Checksec analysis failed, continuing..."
  shell echo ""
  shell echo "=== Phase 2: Binary Information ==="
  shell file ${binary} || echo "File type detection failed"
  shell readelf -h ${binary} 2>/dev/null || echo "Not an ELF binary, skipping readelf"
  shell echo ""
  shell echo "=== Phase 3: Binary Lifting to LLVM IR ==="
  shell pf lift-inspect binary=${binary} || echo "Binary lifting not available, skipping..."
  shell echo ""
  shell echo "=== Phase 4: Analysis Summary ==="
  shell echo "Analysis complete! Results:"
  shell echo "  - Security features checked"
  shell echo "  - Binary format analyzed"
  shell echo "  - LLVM IR lifting attempted"
  shell echo ""
  shell echo "Next steps:"
  shell echo "  pf debug binary=${binary}           # Start interactive debugging"
  shell echo "  pf rop-gadgets binary=${binary}     # Find ROP gadgets"
  shell echo "  pf lift-binary-retdec binary=${binary}  # Full LLVM lifting"
end

# ============================================================================
# Smart Exploit Development Workflow
# ============================================================================

task smart-exploit-dev
  describe Intelligent exploit development: checksec â†’ rop-gadgets â†’ exploit-gen
  describe Automatically determines best exploitation strategy based on binary protections
  shell_lang bash
  shell test -n "${binary}" || (echo "Error: binary parameter required. Usage: pf smart-exploit-dev binary=/path/to/binary" && exit 1)
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         SMART EXPLOIT DEVELOPMENT WORKFLOW                â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "Target: ${binary}"
  shell echo ""
  shell echo "=== Phase 1: Security Analysis ==="
  shell python3 tools/exploit/checksec_batch.py ${binary} --json > /tmp/checksec-${$}.json || echo "Checksec failed"
  shell echo ""
  shell echo "=== Phase 2: ROP Gadget Discovery ==="
  shell pf rop-gadgets binary=${binary} 2>&1 | head -50 || echo "ROP gadget search not available"
  shell echo ""
  shell echo "=== Phase 3: Exploit Strategy Recommendation ==="
  shell python3 -c "
import json, sys, os
try:
    with open('/tmp/checksec-${$}.json') as f:
        data = json.load(f)
    print('Based on security features:')
    # Check for NX
    if 'NX' in str(data) or 'nx' in str(data).lower():
        print('  âœ“ NX enabled â†’ Use ROP-based exploitation')
        print('  Next: pf rop-chain-build binary=${binary}')
    else:
        print('  âœ— NX disabled â†’ Shellcode injection possible')
        print('  Next: pf pwn-shellcode arch=amd64')
    # Check for PIE
    if 'PIE' in str(data) or 'pie' in str(data).lower():
        print('  âœ“ PIE enabled â†’ Need information leak')
        print('  Consider: format string vulnerability for leak')
    # Check for RELRO
    if 'RELRO' in str(data):
        print('  âœ“ RELRO enabled â†’ GOT overwrite limited')
except:
    print('Could not parse checksec output')
    print('Recommended approach:')
    print('  1. Use pf debug binary=${binary} to analyze')
    print('  2. Use pf rop-gadgets binary=${binary} for ROP chains')
    print('  3. Generate exploit template with pf pwn-template')
" || echo "Analysis script failed"
  shell echo ""
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         EXPLOIT DEVELOPMENT READY                         â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
end

# ============================================================================
# Smart Security Testing Workflow (Web + Binary)
# ============================================================================

task smart-security-test
  describe Comprehensive security testing: web scan + binary analysis + fuzzing
  describe Intelligently tests web apps and their backend binaries
  shell_lang bash
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         SMART SECURITY TESTING WORKFLOW                   â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell if [ -n "${url}" ]; then
  shell   echo "=== Phase 1: Web Application Security Scan ==="
  shell   pf security-scan url=${url} || echo "Web security scan failed"
  shell   echo ""
  shell   echo "=== Phase 2: API Fuzzing ==="
  shell   pf security-fuzz url=${url} type=all || echo "Fuzzing failed"
  shell fi
  shell echo ""
  shell if [ -n "${binary}" ]; then
  shell   echo "=== Phase 3: Binary Security Analysis ==="
  shell   pf smart-binary-analysis binary=${binary} || echo "Binary analysis failed"
  shell   echo ""
  shell   echo "=== Phase 4: Binary Fuzzing ==="
  shell   echo "Consider using pf fuzz-* tasks for binary fuzzing"
  shell fi
  shell echo ""
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         SECURITY TESTING COMPLETE                         â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
end

# ============================================================================
# Smart Kernel Debugging Workflow
# ============================================================================

task smart-kernel-analysis
  describe Intelligent kernel module/driver analysis: lift â†’ parse-detect â†’ complexity â†’ fuzz
  describe Automatically analyzes kernel binaries for vulnerabilities
  shell_lang bash
  shell test -n "${binary}" || (echo "Error: binary parameter required. Usage: pf smart-kernel-analysis binary=/path/to/binary" && exit 1)
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         SMART KERNEL ANALYSIS WORKFLOW                    â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "Target: ${binary}"
  shell echo ""
  shell echo "=== Phase 1: Binary Lifting ==="
  shell pf lift-binary-retdec binary=${binary} 2>&1 | tail -20 || echo "Lifting failed, continuing..."
  shell echo ""
  shell echo "=== Phase 2: Automagic Vulnerability Analysis ==="
  shell pf kernel-automagic-analysis binary=${binary} 2>&1 | head -100 || echo "Kernel analysis not available"
  shell echo ""
  shell echo "=== Phase 3: Parse Function Detection ==="
  shell pf kernel-parse-detect binary=${binary} 2>&1 | head -50 || echo "Parse detection not available"
  shell echo ""
  shell echo "=== Phase 4: Complexity Analysis ==="
  shell pf kernel-complexity-analyze binary=${binary} 2>&1 | head -50 || echo "Complexity analysis not available"
  shell echo ""
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         KERNEL ANALYSIS COMPLETE                          â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "Next steps for discovered vulnerabilities:"
  shell echo "  pf kernel-fuzz-in-memory binary=${binary} function=<detected_func>"
end

# ============================================================================
# Smart Container + Package Workflow
# ============================================================================

task smart-package-install
  describe Intelligent package installation: auto-detect format â†’ convert â†’ install
  describe Automatically handles package format conversion and installation
  shell_lang bash
  shell test -n "${package}" || (echo "Error: package parameter required. Usage: pf smart-package-install package=/path/to/package" && exit 1)
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         SMART PACKAGE INSTALLATION WORKFLOW               â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "Package: ${package}"
  shell echo ""
  shell echo "=== Phase 1: Package Format Detection ==="
  shell PKG_EXT="${package##*.}"
  shell echo "Detected format: $PKG_EXT"
  shell echo ""
  shell echo "=== Phase 2: System Package Manager Detection ==="
  shell if command -v apt-get >/dev/null 2>&1; then
  shell   echo "System: Debian/Ubuntu (apt)"
  shell   TARGET_FORMAT="deb"
  shell elif command -v dnf >/dev/null 2>&1; then
  shell   echo "System: Fedora/RHEL (dnf)"
  shell   TARGET_FORMAT="rpm"
  shell elif command -v pacman >/dev/null 2>&1; then
  shell   echo "System: Arch (pacman)"
  shell   TARGET_FORMAT="pacman"
  shell else
  shell   echo "Unknown package manager, using container-based install"
  shell   TARGET_FORMAT="container"
  shell fi
  shell echo ""
  shell echo "=== Phase 3: Package Conversion (if needed) ==="
  shell if [ "$PKG_EXT" != "$TARGET_FORMAT" ] && [ "$TARGET_FORMAT" != "container" ]; then
  shell   echo "Converting $PKG_EXT to $TARGET_FORMAT..."
  shell   pf pkg-convert source=${package} target=$TARGET_FORMAT || echo "Conversion failed, trying direct install"
  shell else
  shell   echo "No conversion needed"
  shell fi
  shell echo ""
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         PACKAGE READY FOR INSTALLATION                    â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
end

# ============================================================================
# Smart Web Development Workflow
# ============================================================================

task smart-web-dev
  describe Intelligent web development: build â†’ test â†’ security-check â†’ serve
  describe Complete development workflow with automatic building and testing
  shell_lang bash
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         SMART WEB DEVELOPMENT WORKFLOW                    â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "=== Phase 1: Auto-Build Detection ==="
  shell pf build_detect || echo "Build detection not available"
  shell echo ""
  shell echo "=== Phase 2: Build All WASM Modules ==="
  shell pf web-build-all 2>&1 | tail -20 || echo "WASM build failed"
  shell echo ""
  shell echo "=== Phase 3: Run Tests ==="
  shell npm run test:unit 2>&1 | tail -30 || echo "Tests not available or failed"
  shell echo ""
  shell echo "=== Phase 4: Quick Security Check ==="
  shell echo "Checking for common security issues..."
  shell grep -r "eval(" demos/ 2>/dev/null && echo "âš  Warning: eval() usage found" || echo "âœ“ No eval() usage"
  shell grep -r "innerHTML" demos/ 2>/dev/null && echo "âš  Warning: innerHTML usage found (XSS risk)" || echo "âœ“ No innerHTML usage"
  shell echo ""
  shell echo "=== Phase 5: Starting Development Server ==="
  shell echo "Server will start on http://localhost:${port:-8080}"
  shell pf web-dev port=${port:-8080} || echo "Server failed to start"
end

# ============================================================================
# Workflow Help
# ============================================================================

task smart-workflows-help
  describe Show help for all smart integrated workflows
  shell_lang bash
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         SMART INTEGRATED WORKFLOWS                        â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "Available Smart Workflows:"
  shell echo ""
  shell echo "1. smart-binary-analysis binary=<path>"
  shell echo "   â†’ Comprehensive binary analysis (checksec + lift + analyze)"
  shell echo ""
  shell echo "2. smart-exploit-dev binary=<path>"
  shell echo "   â†’ Intelligent exploit development (checksec + ROP + strategy)"
  shell echo ""
  shell echo "3. smart-security-test url=<url> binary=<path>"
  shell echo "   â†’ Complete security testing (web + binary + fuzzing)"
  shell echo ""
  shell echo "4. smart-kernel-analysis binary=<path>"
  shell echo "   â†’ Kernel module analysis (lift + parse-detect + complexity)"
  shell echo ""
  shell echo "5. smart-package-install package=<path>"
  shell echo "   â†’ Auto-format detection and conversion"
  shell echo ""
  shell echo "6. smart-web-dev [port=8080]"
  shell echo "   â†’ Complete web dev workflow (build + test + security + serve)"
  shell echo ""
  shell echo "These workflows combine multiple tools intelligently to"
  shell echo "accomplish complex tasks with a single command."
end
