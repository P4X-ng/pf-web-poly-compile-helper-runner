# Smart Integrated Workflows
# Combined tool workflows that leverage multiple tools intelligently
# This file represents "Round 1" of tightening tool integration

# ============================================================================
# Smart Binary Analysis Workflow
# Combines: checksec, ROP analysis, pwntools, and exploitation
# ============================================================================

task smart-analyze-binary
  describe Intelligent binary analysis combining multiple tools
  describe Usage: pf smart-analyze-binary binary=/path/to/binary
  shell test -n "${binary}" || (echo "Error: binary parameter required" && exit 1)

# Smart Workflow Tasks for pf-runner
# Round 2: Integration tightening - combining tools intelligently
# These tasks demonstrate "doing less, but doing it smart" by creating
# powerful workflows that combine multiple tools for awesome results

# ============================================================================
# Vulnerability Discovery Pipeline
# Combines binary analysis, parse function detection, complexity analysis,
# and exploit generation into one smart workflow
# ============================================================================

task vuln-discover
  describe ğŸ” Smart vulnerability discovery pipeline for binaries
  describe Analyzes binary for vulnerabilities, finds parse functions, checks complexity, and generates exploit info

  shell test -n "${binary}" || (echo "Error: binary parameter required. Usage: pf vuln-discover binary=/path/to/binary" && exit 1)
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘     SMART VULNERABILITY DISCOVERY PIPELINE                   â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "Target: ${binary}"
  shell echo ""
  shell echo "â†’ Phase 1: Binary Security Analysis"
  shell pf debug-info binary=${binary} || echo "  â„¹ï¸  Basic info only"
  shell pf checksec-file file=${binary} || echo "  â„¹ï¸  Security check skipped"
  shell echo ""
  shell echo "â†’ Phase 2: Automagic Parse Function Detection"
  shell pf kernel-parse-detect binary=${binary} || echo "  â„¹ï¸  No parse functions detected"
  shell echo ""
  shell echo "â†’ Phase 3: Complexity Analysis (finding dangerous patterns)"
  shell pf kernel-complexity-analyze binary=${binary} || echo "  â„¹ï¸  Complexity analysis skipped"
  shell echo ""
  shell echo "â†’ Phase 4: Exploit Information Gathering"
  shell pf exploit-info binary=${binary} || echo "  â„¹ï¸  Exploit info gathering skipped"
  shell echo ""
  shell echo "â†’ Phase 5: ROP Gadget Search"
  shell pf rop-find-gadgets binary=${binary} output=/tmp/gadgets_${binary##*/}.txt || echo "  â„¹ï¸  Gadget search skipped"
  shell echo ""
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘     VULNERABILITY DISCOVERY COMPLETE                         â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "ğŸ“‹ Summary saved in /tmp/vuln_discover_${binary##*/}_summary.txt"
end

task vuln-discover-and-exploit
  describe ğŸš€ Complete vulnerability discovery and exploit generation workflow
  describe Discovers vulnerabilities, generates ROP chain, and creates exploit template

  shell test -n "${binary}" || (echo "Error: binary parameter required" && exit 1)
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘     DISCOVER & EXPLOIT AUTOMATION                            â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell pf vuln-discover binary=${binary}
  shell echo ""
  shell echo "â†’ Generating ROP Chain..."
  shell pf rop-chain-auto binary=${binary} output=/tmp/rop_chain_${binary##*/}.py || echo "  â„¹ï¸  ROP chain generation skipped"
  shell echo ""
  shell echo "â†’ Creating Exploit Template..."
  shell pf pwn-template-advanced binary=${binary} output=/tmp/exploit_${binary##*/}.py || echo "  â„¹ï¸  Template generation skipped"
  shell echo ""
  shell echo "âœ… Exploit artifacts ready in /tmp/"
end

# ============================================================================
# Secure Build Pipeline
# Combines autobuild, security scanning, testing, and containerization
# into one smart workflow that ensures secure deployments
# ============================================================================

task build-secure
  describe ğŸ”’ Smart secure build pipeline with automatic testing and scanning
  describe Builds project, runs security checks, tests, and containerizes if successful

  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘     SECURE BUILD PIPELINE                                    â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "â†’ Phase 1: Detecting Build System..."
  shell pf build_detect
  shell echo ""
  shell echo "â†’ Phase 2: Building Project..."
  shell pf autobuild ${release:+release=true} ${jobs:+jobs=${jobs}}
  shell echo ""
  shell echo "â†’ Phase 3: Security Scanning Binaries..."
  shell if [ -d "bin" ] || [ -d "build" ] || [ -d "target" ]; then
  shell   echo "  Scanning build artifacts for security issues..."
  shell   find bin build target -type f -executable 2>/dev/null | while read binary; do
  shell     echo "    Checking: $binary"
  shell     pf checksec-file file="$binary" 2>/dev/null || echo "      No security features found"
  shell   done
  shell else
  shell   echo "  â„¹ï¸  No standard build directories found, skipping binary scan"
  shell fi
  shell echo ""
  shell echo "â†’ Phase 4: Running Tests..."
  shell if [ -f "package.json" ]; then
  shell   npm test 2>/dev/null || echo "  â„¹ï¸  Tests skipped or unavailable"
  shell elif [ -f "Cargo.toml" ]; then
  shell   cargo test 2>/dev/null || echo "  â„¹ï¸  Tests skipped or unavailable"
  shell else
  shell   echo "  â„¹ï¸  No test framework detected"
  shell fi
  shell echo ""
  shell echo "â†’ Phase 5: Containerization (optional)..."
  shell if [ "${containerize}" = "true" ]; then
  shell   pf auto-containerize || echo "  â„¹ï¸  Containerization skipped"
  shell else
  shell   echo "  â„¹ï¸  Containerization not requested (use containerize=true to enable)"
  shell fi
  shell echo ""
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘     SECURE BUILD COMPLETE                                    â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
end

task build-secure-web
  describe ğŸŒ Smart secure build pipeline for web applications
  describe Builds web app, runs security scans, and starts dev server for testing

  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘     SECURE WEB BUILD PIPELINE                                â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "â†’ Phase 1: Building Web Application..."
  shell pf autobuild ${release:+release=true}
  shell echo ""
  shell echo "â†’ Phase 2: Security Scanning Web App..."
  shell echo "  Starting development server..."
  shell node tools/api-server.mjs ${dir:-demos/pf-web-polyglot-demo-plus-c/web} 8080 &
  shell SERVER_PID=$!
  shell sleep 5
  shell echo "  Running security scan..."
  shell pf security-scan url=http://localhost:8080 || echo "  âš ï¸  Security scan found issues"
  shell echo "  Stopping server..."
  shell kill $SERVER_PID 2>/dev/null || true
  shell echo ""
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘     SECURE WEB BUILD COMPLETE                                â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "Start dev server with: pf web-dev"
end

# ============================================================================
# Debug-to-Exploit Workflow
# Combines debugging, disassembly, gadget finding, and exploit creation
# for reverse engineering and exploit development
# ============================================================================

task debug-deep-dive
  describe ğŸ”¬ Smart deep-dive debugging and analysis workflow
  describe Disassembles binary, shows security features, finds gadgets, and starts debugger

  shell test -n "${binary}" || (echo "Error: binary parameter required" && exit 1)
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘     DEEP DIVE DEBUGGING WORKFLOW                             â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "Target: ${binary}"
  shell echo ""
  shell echo "â†’ Phase 1: Binary Information"
  shell pf binary-info binary=${binary}
  shell echo ""
  shell echo "â†’ Phase 2: Security Feature Analysis"
  shell pf checksec-file file=${binary}
  shell echo ""
  shell echo "â†’ Phase 3: Disassembly Preview"
  shell pf disassemble binary=${binary} function=${function:-main}
  shell echo ""
  shell echo "â†’ Phase 4: ROP Gadget Analysis"
  shell echo "  Searching for useful ROP gadgets..."
  shell pf rop-find-gadgets binary=${binary} output=/tmp/gadgets_${binary##*/}.txt || echo "  â„¹ï¸  Gadget search skipped"
  shell echo ""
  shell echo "â†’ Phase 5: String Analysis"
  shell echo "  Interesting strings in binary:"
  shell strings ${binary} | grep -E "(password|key|token|secret|flag|admin)" | head -10 || echo "  No interesting strings found"
  shell echo ""
  shell if [ "${interactive}" = "true" ]; then
  shell   echo "â†’ Starting Interactive Debugger..."
  shell   pf debug binary=${binary}
  shell else
  shell   echo "ğŸ’¡ Tip: Add interactive=true to start debugger"
  shell   echo "   Example: pf debug-deep-dive binary=${binary} interactive=true"
  shell fi
end

# ============================================================================
# Binary Lifting and Analysis Pipeline
# Combines binary lifting, LLVM optimization, and re-compilation
# for binary analysis and transformation
# ============================================================================

task lift-analyze-recompile
  describe ğŸ—ï¸ Smart binary lifting, analysis, and recompilation workflow
  describe Lifts binary to LLVM IR, analyzes/optimizes it, and recompiles

  shell test -n "${binary}" || (echo "Error: binary parameter required" && exit 1)
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘     LIFT-ANALYZE-RECOMPILE WORKFLOW                          â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "â†’ Phase 1: Binary Lifting to LLVM IR"
  shell pf lift-binary-retdec binary=${binary} output=/tmp/${binary##*/}.ll
  shell echo ""
  shell echo "â†’ Phase 2: LLVM IR Analysis"
  shell pf lift-inspect binary=${binary}
  shell echo ""
  shell echo "â†’ Phase 3: LLVM IR Optimization"
  shell pf optimize-lifted-ir input=/tmp/${binary##*/}.ll output=/tmp/${binary##*/}_opt.ll
  shell echo ""
  shell echo "â†’ Phase 4: Recompilation to Native Binary"
  shell echo "  Compiling optimized LLVM IR back to binary..."
  shell clang /tmp/${binary##*/}_opt.ll -o /tmp/${binary##*/}_optimized 2>/dev/null && echo "  âœ… Optimized binary: /tmp/${binary##*/}_optimized" || echo "  âš ï¸  Recompilation may require manual fixes"
  shell echo ""
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘     LIFT-ANALYZE-RECOMPILE COMPLETE                          â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
end

# ============================================================================
# Container Development Workflow
# Combines container build, testing, and deployment with smart defaults
# ============================================================================

task dev-containerized
  describe ğŸ³ Smart containerized development workflow
  describe Builds containers, runs tests inside them, and manages container lifecycle

  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘     CONTAINERIZED DEVELOPMENT WORKFLOW                       â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "â†’ Phase 1: Building Container Images"
  shell pf container-build-all
  shell echo ""
  shell echo "â†’ Phase 2: Starting Development Environment"
  shell pf compose-up
  shell echo ""
  shell echo "â†’ Phase 3: Running Containerized Tests"
  shell pf container-test || echo "  â„¹ï¸  Tests skipped"
  shell echo ""
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘     CONTAINERIZED DEV ENVIRONMENT READY                      â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "ğŸ“‹ Available commands:"
  shell echo "   â€¢ pf compose-shell           - Open shell in container"
  shell echo "   â€¢ pf compose-logs            - View container logs"
  shell echo "   â€¢ pf compose-down            - Stop all containers"
end

# ============================================================================
# Kernel Fuzzing Pipeline
# Combines parse detection, complexity analysis, and in-memory fuzzing
# for efficient kernel vulnerability discovery
# ============================================================================

task kernel-smart-fuzz
  describe âš¡ Smart kernel fuzzing pipeline with automagic analysis
  describe Detects parse functions, analyzes complexity, and runs fast in-memory fuzzing

  shell test -n "${binary}" || (echo "Error: binary parameter required" && exit 1)
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘     SMART KERNEL FUZZING PIPELINE                            â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "â†’ Phase 1: Automagic Analysis"
  shell pf kernel-automagic-analysis binary=${binary}
  shell echo ""
  shell echo "â†’ Phase 2: Fast In-Memory Fuzzing"
  shell if [ -n "${function}" ]; then
  shell   echo "  Fuzzing specific function: ${function}"
  shell   pf kernel-fuzz-in-memory binary=${binary} function=${function}
  shell else
  shell   echo "  Running comprehensive fuzzing on detected parse functions..."
  shell   pf kernel-fuzz-in-memory binary=${binary}
  shell fi
  shell echo ""
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘     KERNEL FUZZING COMPLETE                                  â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
end

# ============================================================================
# Multi-Language Build and Test
# Smart pipeline that detects languages in a polyglot project and builds all
# ============================================================================

task build-polyglot-smart
  describe ğŸŒ Smart polyglot project builder
  describe Automatically detects and builds all languages in the project

  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘     SMART POLYGLOT BUILD PIPELINE                            â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "â†’ Detecting project languages..."
  shell echo ""
  shell if [ -f "Cargo.toml" ]; then
  shell   echo "  âœ“ Rust detected - building..."
  shell   pf autobuild || echo "    âš ï¸  Rust build failed"
  shell fi
  shell if [ -f "package.json" ]; then
  shell   echo "  âœ“ Node.js detected - building..."
  shell   npm run build 2>/dev/null || npm install || echo "    âš ï¸  Node.js build failed"
  shell fi
  shell if [ -f "Cargo.toml" ] && [ -d "demos/pf-web-polyglot-demo-plus-c" ]; then
  shell   echo "  âœ“ WASM polyglot project detected - building all languages..."
  shell   pf web-build-all-wasm || echo "    âš ï¸  WASM build failed"
  shell fi
  shell if [ -f "go.mod" ]; then
  shell   echo "  âœ“ Go detected - building..."
  shell   go build ./... || echo "    âš ï¸  Go build failed"
  shell fi
  shell if [ -f "pom.xml" ]; then
  shell   echo "  âœ“ Maven project detected - building..."
  shell   mvn compile || echo "    âš ï¸  Maven build failed"
  shell fi
  shell echo ""
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘     POLYGLOT BUILD COMPLETE                                  â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
end

# ============================================================================
# Web Security Full Stack Testing
# Combines web build, deployment, security scanning, and fuzzing
# ============================================================================

task web-security-full-stack
  describe ğŸ›¡ï¸ Complete web application security testing workflow
  describe Builds app, deploys it, runs comprehensive security tests, generates report

  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘     FULL STACK WEB SECURITY TESTING                          â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "â†’ Phase 1: Building Web Application"
  shell pf web-build-all
  shell echo ""
  shell echo "â†’ Phase 2: Starting Test Server"
  shell node tools/api-server.mjs demos/pf-web-polyglot-demo-plus-c/web 8080 &
  shell SERVER_PID=$!
  shell sleep 5
  shell echo ""
  shell echo "â†’ Phase 3: Security Header Analysis"
  shell pf security-check-headers url=http://localhost:8080 || echo "  âš ï¸  Header issues found"
  shell echo ""
  shell echo "â†’ Phase 4: Vulnerability Scanning"
  shell pf security-scan-verbose url=http://localhost:8080 || echo "  âš ï¸  Vulnerabilities found"
  shell echo ""
  shell echo "â†’ Phase 5: Comprehensive Fuzzing"
  shell pf security-fuzz-all url=http://localhost:8080 || echo "  âš ï¸  Fuzzing found issues"
  shell echo ""
  shell echo "â†’ Phase 6: Generating JSON Report"
  shell pf security-report url=http://localhost:8080 > /tmp/security_report_$(date +%Y%m%d_%H%M%S).json
  shell echo "  Report saved to /tmp/security_report_*.json"
  shell echo ""
  shell echo "â†’ Cleanup: Stopping Test Server"
  shell kill $SERVER_PID 2>/dev/null || true
  shell echo ""
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘     WEB SECURITY TESTING COMPLETE                            â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
end

# ============================================================================
# Quick Aliases for Smart Workflows
# ============================================================================

[alias vd]
task vd
  describe Quick alias for vuln-discover
  shell pf vuln-discover binary=${binary}
end

[alias bs]
task bs
  describe Quick alias for build-secure
  shell pf build-secure ${release:+release=${release}} ${jobs:+jobs=${jobs}} ${containerize:+containerize=${containerize}}
end

[alias dd]
task dd
  describe Quick alias for debug-deep-dive
  shell pf debug-deep-dive binary=${binary} ${function:+function=${function}} ${interactive:+interactive=${interactive}}
end

[alias ksf]
task ksf
  describe Quick alias for kernel-smart-fuzz
  shell pf kernel-smart-fuzz binary=${binary} ${function:+function=${function}}
end

[alias wsfs]
task wsfs
  describe Quick alias for web-security-full-stack
  shell pf web-security-full-stack
end

# ============================================================================
# Smart Installation Workflows
# Installs tools based on use case rather than individual packages
# ============================================================================

task install-dev-essentials
  describe ğŸ”§ Install essential development tools for all workflows
  describe Installs core tools needed for most development scenarios

  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘     INSTALLING DEVELOPMENT ESSENTIALS                        â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "â†’ Phase 1: Core pf Installation"
  shell pf install-base || echo "  â„¹ï¸  pf already installed"
  shell echo ""
  shell echo "â†’ Phase 2: Debugging Tools"
  shell pf install-debuggers || echo "  âš ï¸  Debugger installation failed"
  shell echo ""
  shell echo "â†’ Phase 3: Build Tools"
  shell echo "  Checking build tools availability..."
  shell which gcc && gcc --version | head -1 || echo "  â„¹ï¸  GCC not found"
  shell which clang && clang --version | head -1 || echo "  â„¹ï¸  Clang not found"
  shell which rustc && rustc --version || echo "  â„¹ï¸  Rust not found"
  shell which node && node --version || echo "  â„¹ï¸  Node.js not found"
  shell echo ""
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘     DEVELOPMENT ESSENTIALS INSTALLED                         â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "ğŸ’¡ Next steps:"
  shell echo "   â€¢ For security research: pf install-security-researcher"
  shell echo "   â€¢ For web development: pf install-web-developer"
  shell echo "   â€¢ For exploit dev: pf install-exploit-developer"
end

task install-security-researcher
  describe ğŸ” Install complete security research toolkit
  describe Everything needed for binary analysis, exploit dev, and vulnerability research

  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘     INSTALLING SECURITY RESEARCH TOOLKIT                     â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "This will install:"
  shell echo "  â€¢ GDB, LLDB, pwndbg (debugging)"
  shell echo "  â€¢ pwntools, ROPgadget, ropper (exploit dev)"
  shell echo "  â€¢ checksec (binary security analysis)"
  shell echo "  â€¢ RetDec (binary lifting)"
  shell echo "  â€¢ Radare2, Ghidra (reverse engineering)"
  shell echo "  â€¢ Security scanning tools"
  shell echo ""
  shell read -p "Continue? [Y/n] " -n 1 -r
  shell echo
  shell if [[ ! $REPLY =~ ^[Nn]$ ]]; then
  shell   echo "â†’ Installing debugging tools..."
  shell   pf install-debuggers || echo "  âš ï¸  Debugger installation failed"
  shell   echo ""
  shell   echo "â†’ Installing exploit development tools..."
  shell   pf install-exploit-tools || echo "  âš ï¸  Exploit tools installation failed"
  shell   echo ""
  shell   echo "â†’ Installing binary lifting tools..."
  shell   pf install-lifting-tools || echo "  âš ï¸  Lifting tools installation failed"
  shell   echo ""
  shell   echo "â†’ Installing reverse engineering tools..."
  shell   pf install-radare2 || echo "  â„¹ï¸  Radare2 installation skipped"
  shell   pf install-ghidra || echo "  â„¹ï¸  Ghidra installation skipped"
  shell   echo ""
  shell   echo "â†’ Installing security scanning tools..."
  shell   pf install-security-tools || echo "  â„¹ï¸  Security tools already installed"
  shell   echo ""
  shell   echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell   echo "â•‘     SECURITY RESEARCH TOOLKIT INSTALLED                      â•‘"
  shell   echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell   echo ""
  shell   echo "ğŸ¯ Try these workflows:"
  shell   echo "   pf vd binary=./target                  # Vulnerability discovery"
  shell   echo "   pf dd binary=./target interactive=true # Deep debugging"
  shell   echo "   pf ksf binary=./module                 # Kernel fuzzing"
  shell else
  shell   echo "Installation cancelled."
  shell fi
end

task install-web-developer
  describe ğŸŒ Install complete web development toolkit
  describe Everything needed for web app development, WASM compilation, and security testing

  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘     INSTALLING WEB DEVELOPMENT TOOLKIT                       â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "This will install:"
  shell echo "  â€¢ Core pf runner"
  shell echo "  â€¢ Web security scanning tools"
  shell echo "  â€¢ WASM build dependencies"
  shell echo ""
  shell echo "â†’ Installing core pf..."
  shell pf install-base || echo "  â„¹ï¸  pf already installed"
  shell echo ""
  shell echo "â†’ Installing web security tools..."
  shell pf install-security-tools || echo "  â„¹ï¸  Security tools already installed"
  shell echo ""
  shell echo "â†’ Checking WASM build tools..."
  shell which wasm-pack && wasm-pack --version || echo "  â„¹ï¸  wasm-pack not found (install with: cargo install wasm-pack)"
  shell which emcc && emcc --version | head -1 || echo "  â„¹ï¸  Emscripten not found"
  shell which wat2wasm && wat2wasm --version || echo "  â„¹ï¸  WABT not found"
  shell echo ""
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘     WEB DEVELOPMENT TOOLKIT INSTALLED                        â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "ğŸš€ Try these workflows:"
  shell echo "   pf build-secure-web              # Secure web build"
  shell echo "   pf wsfs                          # Full security testing"
  shell echo "   pf web-dev                       # Start dev server"
end

task install-exploit-developer
  describe ğŸ’¥ Install complete exploit development toolkit
  describe Everything needed for exploit development and binary exploitation

  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘     INSTALLING EXPLOIT DEVELOPMENT TOOLKIT                   â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "â†’ Installing debugging tools..."
  shell pf install-debuggers || echo "  âš ï¸  Debugger installation failed"
  shell echo ""
  shell echo "â†’ Installing exploit development tools..."
  shell pf install-exploit-tools || echo "  âš ï¸  Exploit tools installation failed"
  shell echo ""
  shell echo "â†’ Installing binary injection tools..."
  shell pf install-injection-tools || echo "  âš ï¸  Injection tools installation failed"
  shell echo ""
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘     EXPLOIT DEVELOPMENT TOOLKIT INSTALLED                    â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "ğŸ’£ Try these workflows:"
  shell echo "   pf vuln-discover-and-exploit binary=./target"
  shell echo "   pf dd binary=./target interactive=true"
  shell echo "   pf rop-demo                      # ROP demo"
end

task install-check-all
  describe âœ… Check installation status of all tools
  describe Comprehensive check of which tools are installed and working

  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘     CHECKING INSTALLATION STATUS                             â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "â†’ Core Tools"
  shell which pf && echo "  âœ“ pf installed" || echo "  âœ— pf not installed"
  shell which python3 && python3 --version || echo "  âœ— Python 3 not found"
  shell which node && node --version || echo "  âœ— Node.js not found"
  shell echo ""
  shell echo "â†’ Build Tools"
  shell which gcc && echo "  âœ“ GCC installed" || echo "  âœ— GCC not installed"
  shell which clang && echo "  âœ“ Clang installed" || echo "  âœ— Clang not installed"
  shell which rustc && echo "  âœ“ Rust installed" || echo "  âœ— Rust not installed"
  shell which cargo && echo "  âœ“ Cargo installed" || echo "  âœ— Cargo not installed"
  shell which cmake && echo "  âœ“ CMake installed" || echo "  âœ— CMake not installed"
  shell echo ""
  shell echo "â†’ Debugging Tools"
  shell which gdb && echo "  âœ“ GDB installed" || echo "  âœ— GDB not installed"
  shell which lldb && echo "  âœ“ LLDB installed" || echo "  âœ— LLDB not installed"
  shell test -d "$HOME/.pwndbg" && echo "  âœ“ pwndbg installed" || echo "  âœ— pwndbg not installed"
  shell echo ""
  shell echo "â†’ Exploit Development"
  shell python3 -c "import pwn" 2>/dev/null && echo "  âœ“ pwntools installed" || echo "  âœ— pwntools not installed"
  shell which ROPgadget && echo "  âœ“ ROPgadget installed" || echo "  âœ— ROPgadget not installed"
  shell which ropper && echo "  âœ“ ropper installed" || echo "  âœ— ropper not installed"
  shell which checksec && echo "  âœ“ checksec installed" || echo "  âœ— checksec not installed"
  shell echo ""
  shell echo "â†’ Reverse Engineering"
  shell which r2 && echo "  âœ“ Radare2 installed" || echo "  âœ— Radare2 not installed"
  shell which retdec-decompiler && echo "  âœ“ RetDec installed" || echo "  âœ— RetDec not installed"
  shell test -d "$HOME/ghidra" && echo "  âœ“ Ghidra installed" || echo "  âœ— Ghidra not installed"
  shell echo ""
  shell echo "â†’ WASM Tools"
  shell which wasm-pack && echo "  âœ“ wasm-pack installed" || echo "  âœ— wasm-pack not installed"
  shell which emcc && echo "  âœ“ Emscripten installed" || echo "  âœ— Emscripten not installed"
  shell which wat2wasm && echo "  âœ“ WABT installed" || echo "  âœ— WABT not installed"
  shell echo ""
  shell echo "â†’ Container Tools"
  shell which podman && echo "  âœ“ Podman installed" || echo "  âœ— Podman not installed"
  shell which docker && echo "  âœ“ Docker installed" || echo "  âœ— Docker not installed"
  shell echo ""
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘     CHECK COMPLETE                                           â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
end

# Quick aliases for installation workflows
[alias ide]
task ide
  describe Quick alias for install-dev-essentials
  shell pf install-dev-essentials
end

[alias isr]
task isr
  describe Quick alias for install-security-researcher
  shell pf install-security-researcher
end

[alias iwd]
task iwd
  describe Quick alias for install-web-developer
  shell pf install-web-developer
end

[alias ied]
task ied
  describe Quick alias for install-exploit-developer
  shell pf install-exploit-developer
end

=======
# Smart Workflows for Integrated Security Testing
# Intelligent workflows that combine multiple tools automatically
# Reduces cognitive load from 100+ individual tasks to smart, context-aware workflows
# Combined from PRs #194, #195, #196

# ============================================================================
# Core Smart Workflows - The "Just Works" Tasks
# ============================================================================

task smart-detect-tools
  describe Detect available security tools and their capabilities
  shell node tools/orchestration/tool-detector.mjs --format json --output tools-capabilities.json
  shell echo "Tool capabilities saved to tools-capabilities.json"
  shell echo "Use 'pf smart-show-capabilities' to view available tools"
end

task smart-show-capabilities
  describe Show detected tool capabilities in human-readable format
  shell node tools/orchestration/tool-detector.mjs --format table
end

task smart-detect
  describe Intelligently detect target type and recommend workflow
  shell python3 tools/smart-workflows/target_detector.py ${target} ${format:+--format $format}
end

task smart-analyze
  describe Comprehensive smart analysis of any target
  shell test -n "${target}" || (echo "âŒ Error: target parameter required" && exit 1)
  shell echo "ğŸ§  Smart Analysis starting for: ${target}"
  shell python3 tools/smart-workflows/target_detector.py ${target} --format json > .smart_target_info.json
  shell python3 tools/orchestration/smart_analyzer.py ${target} ${deep:+--deep-analysis} ${format:+--format $format} ${output:+--output $output}
end

task smart-exploit
  describe  ğŸ¯ Smart exploit development - from binary to working exploit automatically
  shell test -n "${binary}" || (echo "âŒ Error: binary parameter required" && exit 1)
  shell echo "ğŸ’¥ Smart Exploit Development: ${binary}"
  shell python3 tools/orchestration/smart_exploiter.py ${binary} ${output:+--output $output} ${arch:+--arch $arch} ${technique:+--technique $technique}
end

task smart-fuzz
  describe ğŸš€ Smart fuzzing - automatically detects target type and uses optimal strategy
  shell test -n "${target}" || (echo "âŒ Error: target parameter required" && exit 1)
  shell python3 tools/smart-workflows/smart_fuzzer_selector.py ${target} ${duration:+--duration $duration} ${strategy:+--strategy $strategy}
end

task smart-security-test
  describe ğŸ”’ Smart security testing - comprehensive security assessment
  shell test -n "${target}" || (echo "âŒ Error: target parameter required" && exit 1)
  shell python3 tools/smart-workflows/smart_scanner.py ${target} ${mode:+--mode $mode}
end

# ============================================================================
# Intelligent Binary Analysis Workflows
# ============================================================================

task smart-binary-analysis
  describe Complete automated binary analysis workflow (binary=path/to/binary)
  shell test -n "${binary}" || (echo "Error: binary parameter required" && exit 1)
  shell echo "ğŸ” Starting intelligent binary analysis for: ${binary}"
  shell node tools/orchestration/workflow-engine.mjs binary-analysis --target "${binary}" --output "${output:-analysis-report.json}" --verbose
end

task smart-binary-exploit
  describe Full binary analysis + exploit generation workflow (binary=path/to/binary)
  shell test -n "${binary}" || (echo "Error: binary parameter required" && exit 1)
  shell echo "ğŸ’¥ Starting binary exploitation workflow for: ${binary}"
  shell node tools/orchestration/workflow-engine.mjs binary-exploit --target "${binary}" --output "${output:-exploit-report.json}" --generate-payloads
end

# ============================================================================
# One-Command Complete Workflows (from PR #196)
# ============================================================================

task autopwn
  describe Complete binary exploitation: analysis + vulnerability discovery + exploit generation (binary=path/to/binary)
  shell test -n "${binary}" || (echo "âŒ Error: binary parameter required" && exit 1)
  shell echo "ğŸ¯ AutoPwn: Complete binary exploitation workflow"
  shell echo "Target: ${binary}"
  shell echo ""
  
  # Phase 1: Basic Analysis
  shell echo "ğŸ“‹ Phase 1: Basic Analysis"
  shell pf unified-checksec binary="${binary}" || true
  shell file "${binary}"
  shell echo ""
  
  # Phase 2: Vulnerability Discovery
  shell echo "ğŸ” Phase 2: Vulnerability Discovery"
  shell pf debug-analyze-binary binary="${binary}" quick=true || true
  shell strings "${binary}" | grep -E "(password|admin|flag|key)" | head -10 || true
  shell echo ""
  
  # Phase 3: Exploitation Prep
  shell echo "ğŸ’¥ Phase 3: Exploitation Preparation"
  shell pf rop-find-gadgets binary="${binary}" limit=20 || true
  shell pf create-exploit-template binary="${binary}" type=buffer_overflow || true
  shell echo ""
  
  shell echo "âœ… AutoPwn complete! Check generated exploit template and ROP gadgets."
end

task autoweb
  describe Complete web security assessment: discovery + scanning + exploitation (url=http://target)
  shell test -n "${url}" || (echo "âŒ Error: url parameter required" && exit 1)
  shell echo "ğŸŒ AutoWeb: Complete web security assessment"
  shell echo "Target: ${url}"
  shell echo ""
  
  # Phase 1: Discovery
  shell echo "ğŸ“‹ Phase 1: Service Discovery"
  shell curl -I "${url}" 2>/dev/null | head -10 || echo "Basic HTTP check failed"
  shell echo ""
  
  # Phase 2: Security Scanning
  shell echo "ğŸ” Phase 2: Security Scanning"
  shell pf security-scan url="${url}" checks=sqli,xss,cmdi || true
  shell echo ""
  
  # Phase 3: Fuzzing
  shell echo "ğŸ’¥ Phase 3: Vulnerability Fuzzing"
  shell pf security-fuzz url="${url}" type=all || true
  shell echo ""
  
  shell echo "âœ… AutoWeb complete! Review security scan and fuzzing results."
end

# ============================================================================
# Unified Tool Interfaces
# ============================================================================

task unified-checksec
  describe ğŸ›¡ï¸ Unified binary security analysis - smart checksec that chooses best approach
  shell python3 tools/unified/unified_checksec.py ${binary} ${format:+--format $format} ${batch:+--batch} ${output:+--output $output}
end

task checksec-unified
  describe Unified binary security analysis (replaces all other checksec implementations)
  shell test -n "${binary}" || (echo "Error: binary parameter required. Usage: pf checksec-unified binary=/path/to/binary" && exit 1)
  shell python3 tools/unified/unified_checksec.py ${binary} ${json:+--json} ${output:+--output $output}
end

# ============================================================================
# Workflow Management
# ============================================================================

task workflow-status
  describe ğŸ“Š Show status of running smart workflows
  shell python3 tools/orchestration/workflow_manager.py --status ${workflow_id:+--workflow-id $workflow_id}
end

task workflow-history
  describe ğŸ“œ Show workflow execution history and results
  shell python3 tools/orchestration/workflow_manager.py --history ${limit:+--limit $limit} ${filter:+--filter $filter}
end

# ============================================================================
# Quick Aliases for Power Users
# ============================================================================

task apwn
  describe Alias for autopwn
  shell pf autopwn binary=${binary}
end

task aweb
  describe Alias for autoweb
  shell pf autoweb url=${url}
end

task stools
  describe Alias for smart-detect-tools
  shell pf smart-detect-tools
end

task smart-help
  describe â“ Show smart workflows help and usage examples
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘                SMART WORKFLOWS HELP                       â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "ğŸ§  CORE SMART WORKFLOWS (The \"Just Works\" Tasks):"
  shell echo ""
  shell echo "  pf smart-analyze target=<file>           # Smart binary analysis"
  shell echo "  pf smart-exploit binary=<file>           # Automated exploit development"
  shell echo "  pf smart-fuzz target=<file|url>          # Adaptive fuzzing"
  shell echo "  pf smart-security-test target=<file|url> # Comprehensive security testing"
  shell echo ""
  shell echo "ğŸ¯ ONE-COMMAND WORKFLOWS:"
  shell echo ""
  shell echo "  pf autopwn binary=<file>                 # Complete binary exploitation"
  shell echo "  pf autoweb url=<url>                     # Complete web security assessment"
  shell echo ""
  shell echo "ğŸ”¬ ADVANCED WORKFLOWS:"
  shell echo ""
  shell echo "  pf smart-detect target=<file>            # Detect target type"
  shell echo "  pf smart-binary-analysis binary=<file>   # Full binary analysis"
  shell echo ""
  shell echo "ğŸ› ï¸ UNIFIED TOOL INTERFACES:"
  shell echo ""
  shell echo "  pf unified-checksec binary=<file>        # Smart binary security analysis"
  shell echo ""
  shell echo "ğŸ“Š WORKFLOW MANAGEMENT:"
  shell echo ""
  shell echo "  pf workflow-status                       # Show running workflows"
  shell echo "  pf workflow-history                      # Show execution history"
  shell echo ""
  shell echo "âš¡ QUICK ALIASES:"
  shell echo ""
  shell echo "  pf apwn binary=<file>                    # Short for autopwn"
  shell echo "  pf aweb url=<url>                        # Short for autoweb"
  shell echo "  pf stools                                # Short for smart-detect-tools"
  shell echo ""
  shell echo "For detailed documentation, see: docs/SMART-WORKFLOWS.md"
# Smart Integrated Workflows
# Combines multiple tools intelligently for common security and analysis tasks

# ============================================================================
# Smart Binary Analysis Workflow
# ============================================================================

task smart-binary-analysis
  describe Comprehensive binary analysis: checksec â†’ lift â†’ analyze â†’ debug-prep
  describe Automatically analyzes a binary using all available tools intelligently
  shell_lang bash
  shell test -n "${binary}" || (echo "Error: binary parameter required. Usage: pf smart-binary-analysis binary=/path/to/binary" && exit 1)
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         SMART BINARY ANALYSIS WORKFLOW                   â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "[1/5] Binary Security Analysis (checksec)..."
  shell python3 tools/security/checksec.py ${binary} || echo "âš  checksec failed"
  shell echo ""
  shell echo "[2/5] Identifying Exploit Vectors..."
  shell python3 pf-runner/pf_main.py run exploit-info binary=${binary} 2>/dev/null || echo "âš  exploit-info unavailable"
  shell echo ""
  shell echo "[3/5] ROP Gadget Analysis..."
  shell python3 tools/exploit/ropgadget_wrapper.py --analyze ${binary} 2>/dev/null || echo "âš  ROP analysis unavailable (install with: pf install-ropgadget)"
  shell echo ""
  shell echo "[4/5] Searching for Common Exploit Patterns..."
  shell python3 tools/exploit/ropgadget_wrapper.py --specific ${binary} --patterns "pop rdi,pop rsi,pop rdx,syscall" 2>/dev/null || echo "âš  Pattern search unavailable"
  shell echo ""
  shell echo "[5/5] Generating Quick Exploit Template..."
  shell python3 tools/exploit/pwntools_wrapper.py --template ${binary}_exploit.py --binary ${binary} 2>/dev/null && echo "âœ“ Exploit template: ${binary}_exploit.py" || echo "âš  Template generation unavailable (install with: pf install-pwntools)"
  shell echo ""
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         ANALYSIS COMPLETE                                 â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "Next steps:"
  shell echo "  - Review ${binary}_exploit.py for exploit development"
  shell echo "  - Run: pf smart-exploit-binary binary=${binary} for automated exploit"
  shell echo "  - Run: pf smart-fuzz-binary binary=${binary} for fuzzing"
  shell echo "Target: ${binary}"
  shell echo ""
  shell echo "=== Phase 1: Security Check (checksec) ==="
  shell python3 tools/exploit/checksec_batch.py ${binary} --output /tmp/smart-analysis-${$}.json || echo "Checksec analysis failed, continuing..."
  shell echo ""
  shell echo "=== Phase 2: Binary Information ==="
  shell file ${binary} || echo "File type detection failed"
  shell readelf -h ${binary} 2>/dev/null || echo "Not an ELF binary, skipping readelf"
  shell echo ""
  shell echo "=== Phase 3: Binary Lifting to LLVM IR ==="
  shell pf lift-inspect binary=${binary} || echo "Binary lifting not available, skipping..."
  shell echo ""
  shell echo "=== Phase 4: Analysis Summary ==="
  shell echo "Analysis complete! Results:"
  shell echo "  - Security features checked"
  shell echo "  - Binary format analyzed"
  shell echo "  - LLVM IR lifting attempted"
  shell echo ""
  shell echo "Next steps:"
  shell echo "  pf debug binary=${binary}           # Start interactive debugging"
  shell echo "  pf rop-gadgets binary=${binary}     # Find ROP gadgets"
  shell echo "  pf lift-binary-retdec binary=${binary}  # Full LLVM lifting"
end

# ============================================================================
# Smart Exploit Development Workflow
# Combines: vulnerability detection, exploit generation, and testing
# ============================================================================

task smart-exploit-binary
  describe Automated exploit development combining multiple techniques
  describe Usage: pf smart-exploit-binary binary=/path/to/binary
  shell test -n "${binary}" || (echo "Error: binary parameter required" && exit 1)
# ============================================================================

task smart-exploit-dev
  describe Intelligent exploit development: checksec â†’ rop-gadgets â†’ exploit-gen
  describe Automatically determines best exploitation strategy based on binary protections
  shell_lang bash
  shell test -n "${binary}" || (echo "Error: binary parameter required. Usage: pf smart-exploit-dev binary=/path/to/binary" && exit 1)
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         SMART EXPLOIT DEVELOPMENT WORKFLOW                â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "[1/4] Analyzing binary security features..."
  shell python3 tools/security/checksec.py ${binary} --json > /tmp/${binary##*/}_checksec.json || echo "âš  checksec failed"
  shell echo ""
  shell echo "[2/4] Building ROP chain..."
  shell python3 tools/exploit/ropgadget_wrapper.py --build-chain ${binary} --output /tmp/${binary##*/}_rop_chain.py 2>/dev/null || echo "âš  ROP chain generation unavailable"
  shell echo ""
  shell echo "[3/4] Generating exploit template with ROP integration..."
  shell python3 tools/exploit/pwntools_wrapper.py --template /tmp/${binary##*/}_full_exploit.py --binary ${binary} 2>/dev/null || echo "âš  Template generation unavailable"
  shell echo ""
  shell echo "[4/4] Creating test harness..."
  shell echo "#!/usr/bin/env python3" > /tmp/${binary##*/}_test_exploit.py
  shell echo "# Generated test harness for ${binary}" >> /tmp/${binary##*/}_test_exploit.py
  shell echo "# Run: python3 /tmp/${binary##*/}_test_exploit.py" >> /tmp/${binary##*/}_test_exploit.py
  shell echo "" >> /tmp/${binary##*/}_test_exploit.py
  shell echo "import os" >> /tmp/${binary##*/}_test_exploit.py
  shell echo "print('Test harness created. Integrate ROP chain and exploit template.')" >> /tmp/${binary##*/}_test_exploit.py
  shell chmod +x /tmp/${binary##*/}_test_exploit.py
  shell echo ""
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         EXPLOIT DEVELOPMENT COMPLETE                      â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "Generated files:"
  shell echo "  - /tmp/${binary##*/}_checksec.json (security analysis)"
  shell echo "  - /tmp/${binary##*/}_rop_chain.py (ROP chain)"
  shell echo "  - /tmp/${binary##*/}_full_exploit.py (exploit template)"
  shell echo "  - /tmp/${binary##*/}_test_exploit.py (test harness)"
end

# ============================================================================
# Smart Fuzzing Workflow
# Combines: binary fuzzing, crash analysis, and exploit generation
# ============================================================================

task smart-fuzz-binary
  describe Intelligent fuzzing with automatic crash analysis
  describe Usage: pf smart-fuzz-binary binary=/path/to/binary [duration=60]
  shell test -n "${binary}" || (echo "Error: binary parameter required" && exit 1)
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         SMART FUZZING WORKFLOW                            â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "[1/3] Analyzing binary for fuzzing targets..."
  shell python3 tools/security/checksec.py ${binary}
  shell echo ""
  shell echo "[2/3] Running targeted fuzzing (${duration:-60} seconds)..."
  shell echo "âš  Basic fuzzing implementation - full fuzzing infrastructure coming soon"
  shell echo "  Tip: Use 'pf fuzz-stack-overflow binary=${binary}' for specific vulnerability types"
  shell echo ""
  shell echo "[3/3] Analyzing crashes and generating exploits..."
  shell echo "âš  Crash analysis will be integrated in future releases"
  shell echo ""
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         FUZZING WORKFLOW COMPLETE                         â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "Next steps:"
  shell echo "  - Check for crashes in fuzzing output"
  shell echo "  - Run: pf smart-analyze-binary binary=${binary} on crash binaries"
  shell echo "  - Use practice binaries: pf build-practice-binaries"
end

# ============================================================================
# Smart Web Security Testing Workflow
# Combines: scanning, fuzzing, and exploit generation
# ============================================================================

task smart-test-web-security
  describe Comprehensive web security testing combining scanner and fuzzer
  describe Usage: pf smart-test-web-security url=http://target:port
  shell test -n "${url}" || (echo "Error: url parameter required" && exit 1)
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         SMART WEB SECURITY TESTING WORKFLOW               â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "[1/4] Initial reconnaissance and header analysis..."
  shell node tools/security/scanner.mjs ${url} --checks headers --verbose
  shell echo ""
  shell echo "[2/4] Vulnerability scanning (SQLi, XSS, CMDI, XXE, SSRF)..."
  shell node tools/security/scanner.mjs ${url} --checks sqli,xss,cmdi,xxe,ssrf --verbose
  shell echo ""
  shell echo "[3/4] Targeted fuzzing of identified endpoints..."
  shell node tools/security/fuzzer.mjs ${url} --type all --verbose
  shell echo ""
  shell echo "[4/4] Generating comprehensive report..."
  shell mkdir -p /tmp/security-reports
  shell node tools/security/scanner.mjs ${url} --json > /tmp/security-reports/scan_$(date +%Y%m%d_%H%M%S).json
  shell node tools/security/fuzzer.mjs ${url} --type all --json > /tmp/security-reports/fuzz_$(date +%Y%m%d_%H%M%S).json
  shell echo ""
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         WEB SECURITY TESTING COMPLETE                     â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "Reports saved to: /tmp/security-reports/"
  shell echo "Review findings and use binary exploitation tools for discovered binaries"
end

# ============================================================================
# Smart Kernel Analysis Workflow
# Combines: IOCTL detection, complexity analysis, parse function detection
# ============================================================================

task smart-analyze-kernel
  describe Comprehensive kernel binary analysis using automagic detection
  describe Usage: pf smart-analyze-kernel binary=/path/to/kernel/module
  shell test -n "${binary}" || (echo "Error: binary parameter required" && exit 1)
  shell echo "Target: ${binary}"
  shell echo ""
  shell echo "=== Phase 1: Security Analysis ==="
  shell python3 tools/exploit/checksec_batch.py ${binary} --json > /tmp/checksec-${$}.json || echo "Checksec failed"
  shell echo ""
  shell echo "=== Phase 2: ROP Gadget Discovery ==="
  shell pf rop-gadgets binary=${binary} 2>&1 | head -50 || echo "ROP gadget search not available"
  shell echo ""
  shell echo "=== Phase 3: Exploit Strategy Recommendation ==="
  shell python3 -c "
import json, sys, os
try:
    with open('/tmp/checksec-${$}.json') as f:
        data = json.load(f)
    print('Based on security features:')
    # Check for NX
    if 'NX' in str(data) or 'nx' in str(data).lower():
        print('  âœ“ NX enabled â†’ Use ROP-based exploitation')
        print('  Next: pf rop-chain-build binary=${binary}')
    else:
        print('  âœ— NX disabled â†’ Shellcode injection possible')
        print('  Next: pf pwn-shellcode arch=amd64')
    # Check for PIE
    if 'PIE' in str(data) or 'pie' in str(data).lower():
        print('  âœ“ PIE enabled â†’ Need information leak')
        print('  Consider: format string vulnerability for leak')
    # Check for RELRO
    if 'RELRO' in str(data):
        print('  âœ“ RELRO enabled â†’ GOT overwrite limited')
except:
    print('Could not parse checksec output')
    print('Recommended approach:')
    print('  1. Use pf debug binary=${binary} to analyze')
    print('  2. Use pf rop-gadgets binary=${binary} for ROP chains')
    print('  3. Generate exploit template with pf pwn-template')
" || echo "Analysis script failed"
  shell echo ""
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         EXPLOIT DEVELOPMENT READY                         â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
end

# ============================================================================
# Smart Security Testing Workflow (Web + Binary)
# ============================================================================

task smart-security-test
  describe Comprehensive security testing: web scan + binary analysis + fuzzing
  describe Intelligently tests web apps and their backend binaries
  shell_lang bash
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         SMART SECURITY TESTING WORKFLOW                   â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell if [ -n "${url}" ]; then
  shell   echo "=== Phase 1: Web Application Security Scan ==="
  shell   pf security-scan url=${url} || echo "Web security scan failed"
  shell   echo ""
  shell   echo "=== Phase 2: API Fuzzing ==="
  shell   pf security-fuzz url=${url} type=all || echo "Fuzzing failed"
  shell fi
  shell echo ""
  shell if [ -n "${binary}" ]; then
  shell   echo "=== Phase 3: Binary Security Analysis ==="
  shell   pf smart-binary-analysis binary=${binary} || echo "Binary analysis failed"
  shell   echo ""
  shell   echo "=== Phase 4: Binary Fuzzing ==="
  shell   echo "Consider using pf fuzz-* tasks for binary fuzzing"
  shell fi
  shell echo ""
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         SECURITY TESTING COMPLETE                         â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
end

# ============================================================================
# Smart Kernel Debugging Workflow
# ============================================================================

task smart-kernel-analysis
  describe Intelligent kernel module/driver analysis: lift â†’ parse-detect â†’ complexity â†’ fuzz
  describe Automatically analyzes kernel binaries for vulnerabilities
  shell_lang bash
  shell test -n "${binary}" || (echo "Error: binary parameter required. Usage: pf smart-kernel-analysis binary=/path/to/binary" && exit 1)
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         SMART KERNEL ANALYSIS WORKFLOW                    â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "[1/4] Running automagic comprehensive analysis..."
  shell python3 pf-runner/pf_main.py run kernel-automagic-analysis binary=${binary} 2>/dev/null || echo "âš  Automagic analysis unavailable"
  shell echo ""
  shell echo "[2/4] IOCTL handler detection..."
  shell python3 pf-runner/pf_main.py run kernel-ioctl-analyze-binary binary=${binary} 2>/dev/null || echo "âš  IOCTL analysis unavailable"
  shell echo ""
  shell echo "[3/4] Identifying dangerous function calls..."
  shell python3 pf-runner/pf_main.py run kernel-analyze-r2-dangerous binary=${binary} 2>/dev/null || echo "âš  Radare2 analysis unavailable (install radare2)"
  shell echo ""
  shell echo "[4/4] Setting up targeted fuzzing campaign..."
  shell echo "âš  Use: pf kernel-fuzz-in-memory binary=${binary} function=<detected_function>"
  shell echo "Target: ${binary}"
  shell echo ""
  shell echo "=== Phase 1: Binary Lifting ==="
  shell pf lift-binary-retdec binary=${binary} 2>&1 | tail -20 || echo "Lifting failed, continuing..."
  shell echo ""
  shell echo "=== Phase 2: Automagic Vulnerability Analysis ==="
  shell pf kernel-automagic-analysis binary=${binary} 2>&1 | head -100 || echo "Kernel analysis not available"
  shell echo ""
  shell echo "=== Phase 3: Parse Function Detection ==="
  shell pf kernel-parse-detect binary=${binary} 2>&1 | head -50 || echo "Parse detection not available"
  shell echo ""
  shell echo "=== Phase 4: Complexity Analysis ==="
  shell pf kernel-complexity-analyze binary=${binary} 2>&1 | head -50 || echo "Complexity analysis not available"
  shell echo ""
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         KERNEL ANALYSIS COMPLETE                          â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "Next steps:"
  shell echo "  - Review detected parse functions and IOCTL handlers"
  shell echo "  - Run: pf kernel-fuzz-in-memory binary=${binary} function=<target>"
  shell echo "  - Use: pf kernel-swarm-fuzz for large-scale fuzzing"
end

# ============================================================================
# Smart Complete Security Assessment
# The "just works" workflow - analyzes everything intelligently
# ============================================================================

task smart-security-assessment
  describe Complete security assessment combining binary, web, and kernel analysis
  describe Usage: pf smart-security-assessment [binary=path] [url=http://target] [kernel=path]
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         SMART COMPLETE SECURITY ASSESSMENT                â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell mkdir -p /tmp/smart-security-assessment
  shell echo "Assessment started at $(date)" > /tmp/smart-security-assessment/assessment.log
  shell echo ""
  shell if [ -n "${binary}" ]; then \
    echo "â•â•â• Binary Analysis â•â•â•" && \
    python3 pf-runner/pf_main.py run smart-analyze-binary binary=${binary}; \
  fi
  shell echo ""
  shell if [ -n "${url}" ]; then \
    echo "â•â•â• Web Security Testing â•â•â•" && \
    python3 pf-runner/pf_main.py run smart-test-web-security url=${url}; \
  fi
  shell echo ""
  shell if [ -n "${kernel}" ]; then \
    echo "â•â•â• Kernel Analysis â•â•â•" && \
    python3 pf-runner/pf_main.py run smart-analyze-kernel binary=${kernel}; \
  fi
  shell echo ""
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         COMPLETE ASSESSMENT FINISHED                      â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "Results saved to: /tmp/smart-security-assessment/"
  shell echo "For targeted analysis, use:"
  shell echo "  - pf smart-analyze-binary binary=/path/to/binary"
  shell echo "  - pf smart-test-web-security url=http://target"
  shell echo "  - pf smart-analyze-kernel binary=/path/to/module"
end

# ============================================================================
# Help and Documentation
  shell echo "Next steps for discovered vulnerabilities:"
  shell echo "  pf kernel-fuzz-in-memory binary=${binary} function=<detected_func>"
end

# ============================================================================
# Smart Container + Package Workflow
# ============================================================================

task smart-package-install
  describe Intelligent package installation: auto-detect format â†’ convert â†’ install
  describe Automatically handles package format conversion and installation
  shell_lang bash
  shell test -n "${package}" || (echo "Error: package parameter required. Usage: pf smart-package-install package=/path/to/package" && exit 1)
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         SMART PACKAGE INSTALLATION WORKFLOW               â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "Package: ${package}"
  shell echo ""
  shell echo "=== Phase 1: Package Format Detection ==="
  shell PKG_EXT="${package##*.}"
  shell echo "Detected format: $PKG_EXT"
  shell echo ""
  shell echo "=== Phase 2: System Package Manager Detection ==="
  shell if command -v apt-get >/dev/null 2>&1; then
  shell   echo "System: Debian/Ubuntu (apt)"
  shell   TARGET_FORMAT="deb"
  shell elif command -v dnf >/dev/null 2>&1; then
  shell   echo "System: Fedora/RHEL (dnf)"
  shell   TARGET_FORMAT="rpm"
  shell elif command -v pacman >/dev/null 2>&1; then
  shell   echo "System: Arch (pacman)"
  shell   TARGET_FORMAT="pacman"
  shell else
  shell   echo "Unknown package manager, using container-based install"
  shell   TARGET_FORMAT="container"
  shell fi
  shell echo ""
  shell echo "=== Phase 3: Package Conversion (if needed) ==="
  shell if [ "$PKG_EXT" != "$TARGET_FORMAT" ] && [ "$TARGET_FORMAT" != "container" ]; then
  shell   echo "Converting $PKG_EXT to $TARGET_FORMAT..."
  shell   pf pkg-convert source=${package} target=$TARGET_FORMAT || echo "Conversion failed, trying direct install"
  shell else
  shell   echo "No conversion needed"
  shell fi
  shell echo ""
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         PACKAGE READY FOR INSTALLATION                    â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
end

# ============================================================================
# Smart Web Development Workflow
# ============================================================================

task smart-web-dev
  describe Intelligent web development: build â†’ test â†’ security-check â†’ serve
  describe Complete development workflow with automatic building and testing
  shell_lang bash
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         SMART WEB DEVELOPMENT WORKFLOW                    â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "=== Phase 1: Auto-Build Detection ==="
  shell pf build_detect || echo "Build detection not available"
  shell echo ""
  shell echo "=== Phase 2: Build All WASM Modules ==="
  shell pf web-build-all 2>&1 | tail -20 || echo "WASM build failed"
  shell echo ""
  shell echo "=== Phase 3: Run Tests ==="
  shell npm run test:unit 2>&1 | tail -30 || echo "Tests not available or failed"
  shell echo ""
  shell echo "=== Phase 4: Quick Security Check ==="
  shell echo "Checking for common security issues..."
  shell grep -r "eval(" demos/ 2>/dev/null && echo "âš  Warning: eval() usage found" || echo "âœ“ No eval() usage"
  shell grep -r "innerHTML" demos/ 2>/dev/null && echo "âš  Warning: innerHTML usage found (XSS risk)" || echo "âœ“ No innerHTML usage"
  shell echo ""
  shell echo "=== Phase 5: Starting Development Server ==="
  shell echo "Server will start on http://localhost:${port:-8080}"
  shell pf web-dev port=${port:-8080} || echo "Server failed to start"
end

# ============================================================================
# Workflow Help
# ============================================================================

task smart-workflows-help
  describe Show help for all smart integrated workflows
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         SMART WORKFLOWS - INTEGRATED TOOL CHAINS          â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "These workflows combine multiple tools intelligently to 'just work'."
  shell echo ""
  shell echo "BINARY EXPLOITATION:"
  shell echo "  pf smart-analyze-binary binary=/path/to/binary"
  shell echo "    â†’ Combines: checksec + ROP analysis + pwntools + exploit generation"
  shell echo ""
  shell echo "  pf smart-exploit-binary binary=/path/to/binary"
  shell echo "    â†’ Automated exploit development with ROP chains"
  shell echo ""
  shell echo "  pf smart-fuzz-binary binary=/path/to/binary [duration=60]"
  shell echo "    â†’ Intelligent fuzzing with crash analysis"
  shell echo ""
  shell echo "WEB SECURITY:"
  shell echo "  pf smart-test-web-security url=http://target:port"
  shell echo "    â†’ Combines: scanner + fuzzer + vulnerability analysis"
  shell echo ""
  shell echo "KERNEL ANALYSIS:"
  shell echo "  pf smart-analyze-kernel binary=/path/to/kernel/module"
  shell echo "    â†’ Automagic: parse detection + complexity + IOCTL + fuzzing"
  shell echo ""
  shell echo "COMPLETE ASSESSMENT:"
  shell echo "  pf smart-security-assessment [binary=path] [url=http://target] [kernel=path]"
  shell echo "    â†’ Full security assessment across all domains"
  shell echo ""
  shell echo "EXAMPLES:"
  shell echo "  # Analyze a vulnerable binary"
  shell echo "  pf smart-analyze-binary binary=./vulnerable_app"
  shell echo ""
  shell echo "  # Test web application security"
  shell echo "  pf smart-test-web-security url=http://localhost:8080"
  shell echo ""
  shell echo "  # Complete assessment of a system"
  shell echo "  pf smart-security-assessment binary=./app url=http://localhost kernel=./module.ko"
  shell echo ""
  shell echo "For individual tools, see:"
  shell echo "  pf exploit-help      - Exploit development tools"
  shell echo "  pf security-help     - Security testing tools"
  shell echo "  pf kernel-debug-help - Kernel debugging tools"
  shell_lang bash
  shell echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  shell echo "â•‘         SMART INTEGRATED WORKFLOWS                        â•‘"
  shell echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  shell echo ""
  shell echo "Available Smart Workflows:"
  shell echo ""
  shell echo "1. smart-binary-analysis binary=<path>"
  shell echo "   â†’ Comprehensive binary analysis (checksec + lift + analyze)"
  shell echo ""
  shell echo "2. smart-exploit-dev binary=<path>"
  shell echo "   â†’ Intelligent exploit development (checksec + ROP + strategy)"
  shell echo ""
  shell echo "3. smart-security-test url=<url> binary=<path>"
  shell echo "   â†’ Complete security testing (web + binary + fuzzing)"
  shell echo ""
  shell echo "4. smart-kernel-analysis binary=<path>"
  shell echo "   â†’ Kernel module analysis (lift + parse-detect + complexity)"
  shell echo ""
  shell echo "5. smart-package-install package=<path>"
  shell echo "   â†’ Auto-format detection and conversion"
  shell echo ""
  shell echo "6. smart-web-dev [port=8080]"
  shell echo "   â†’ Complete web dev workflow (build + test + security + serve)"
  shell echo ""
  shell echo "These workflows combine multiple tools intelligently to"
  shell echo "accomplish complex tasks with a single command."
end
